# DBT Lineage (Local)

**dbt-lineage-local** is a lightweight VS Code extension that visualizes the immediate dependency graph (Lineage) of your dbt models without requiring a connection to dbt Cloud or an external API. It runs entirely locally using your project's compiled `manifest.json`.

## 1. What It Is

This extension provides a **Data Lineage Panel** inside VS Code that:
*   **Visualizes Relationships:** Shows 1-step Upstream (parents) and Downstream (children) dependencies.
*   **Works Offline:** Reads the standard `target/manifest.json` file generated by dbt.
*   **Interactive:** Double-clicking a node instantly opens that file in your editor.
*   **Auto-Updating:** As you click through different SQL files in your explorer, the graph automatically refreshes to show the lineage for the active file.
*   **Source Support:** Handles dbt Sources and Seeds (visualizes them as upstream nodes).

## 2. Requirements & Installation

### Prerequisites
1.  **VS Code** installed.
2.  **Python 3.x** installed and added to your system PATH.
3.  A **dbt Project** with a generated `manifest.json`.
    *   *Note: You must run `dbt compile` or `dbt build` at least once.*

### Installation
Since this is a local extension, you install it via the `.vsix` package:

1.  Download the `dbt-lineage-local-x.x.x.vsix` file.
2.  Open VS Code.
3.  Go to the **Extensions** view (`Ctrl+Shift+X`).
4.  Click the `...` (Views and More actions) menu at the top right of the pane.
5.  Select **Install from VSIX...**
6.  Select the downloaded file.

## 3. How to Use

1.  **Open your dbt project** folder in VS Code.
2.  Ensure you have run `dbt compile` so the `target/` folder exists.
3.  Open any `.sql` model file in the editor.
4.  Open the Command Palette (`Ctrl+Shift+P`) and run:
    > **Show dbt Lineage**
5.  A panel will open on the left showing the graph.
6.  **Navigation:**
    *   Click any file in your **File Explorer**; if the Lineage panel is open, it will update automatically.
    *   **Double-click** a node in the graph to jump to that file.

## 4. Architecture (How It Is Built)

The extension consists of three main components:

### A. The Controller (`extension.js`)
*   **Role:** Orchestrator.
*   **Function:** It listens for command activation and file switching events (`onDidChangeActiveTextEditor`).
*   **Logic:** It determines the current model name from the filename, checks for the existence of `dbt_project.yml`, and spawns a child process to run the Python script. It also handles the "Webview Panel" lifecycle.

### B. The Data Parser (`python/l.py`)
*   **Role:** Data Extraction.
*   **Function:** It reads the `target/manifest.json` file.
*   **Logic:** It searches for the specific model name in the manifest nodes, extracts its immediate parents (`depends_on`) and children (by iterating over all nodes), and outputs a JSON object to standard output.

### C. The View (`webview.html` & `vis-network`)
*   **Role:** Visualization.
*   **Function:** Renders the JSON data as a graph.
*   **Library:** Uses **vis-network.js** for organic, hierarchical graph layout.
*   **Logic:** It uses a Left-to-Right hierarchical layout. It calculates dynamic spacing based on the length of node labels to ensure text fits inside the boxes.

